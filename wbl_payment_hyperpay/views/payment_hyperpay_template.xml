<?xml version="1.0" encoding="utf-8"?>
<!--# Author      : Weblytic Labs Pvt. Ltd. (<https://store.weblyticlabs.com/>)-->
<!--# Copyright(c): 2023-Present Weblytic Labs Pvt. Ltd.-->
<odoo>
    <template id="hyperpay_redirect_form">
        <form t-att-action="api_url" method="post">
            <input type="hidden" name="checkout_id" t-att-value="checkout_id"/>
            <input type="hidden" name="merchant_transaction_id" t-att-value="merchantTransactionId"/>
            <input type="hidden" name="paymentMethodCode" t-att-value="paymentMethodCode"/>
            <input type="hidden" name="formatted_amount" t-att-value="formatted_amount"/>
            <input type="hidden" name="payment_url" t-att-value="payment_url"/>
            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
        </form>
    </template>

    <template id="wbl_hyperpay_payment_form">
        <t t-set="additional_title">HyperPay Payment</t>
        <t t-set="head">
            <script src="/web/static/lib/jquery/jquery.js" type="text/javascript"/>
            <script t-att-src="payment_url"></script>
            <script type="text/javascript">
                var wpwlOptions = {
                style: "plain",
                showCVVHint: false,
                maskCvv: true,
                brandDetection: true,
                locale: "en",
                onReady: function(){
                $(".wpwl-group-cardNumber").after($(".wpwl-group-brand").detach());
                $(".wpwl-group-cvv").after( $(".wpwl-group-cardHolder").detach());
                <t t-if="provider == 'hyperpay'">
                    var visa = $(".wpwl-brand:first").clone().removeAttr("class").attr("class", "wpwl-brand-card
                    wpwl-brand-custom wpwl-brand-VISA");
                    var master = $(visa).clone().removeClass("wpwl-brand-VISA").addClass("wpwl-brand-MASTER");
                    $(".wpwl-brand:first").after( $(master)).after( $(visa));
                </t>
                <t t-if="provider == 'mada'">
                    var mada = $(".wpwl-brand:first").clone().removeAttr("class").attr("class", "wpwl-brand-card
                    wpwl-brand-custom wpwl-brand-MADA");
                    $(".wpwl-brand:first").after($(mada));
                </t>
                var imageUrl = "https://eu-test.oppwa.com/v1/static/" + wpwl.cacheVersion + "/img/brand.png";
                $(".wpwl-brand-custom").css("background-image", "url(" + imageUrl + ")");
                $('.wpwl-form-card').find('.wpwl-button-pay').on('click', function(e){
                validateHolder(e);
                });
                },
                onChangeBrand: function(e){
                $(".wpwl-brand-custom").css("opacity", "0.3");
                $(".wpwl-brand-" + e).css("opacity", "1");
                },
                onBeforeSubmitCard: function(e){
                return validateHolder(e);
                }
                }
                function validateHolder(e){
                var holder = $('.wpwl-control-cardHolder').val();
                if (holder.trim().length &lt; 2){
                $('.wpwl-control-cardHolder').addClass('wpwl-has-error').after('&lt;div class="wpwl-hint
                wpwl-hint-cardHolderError">Invalid card holder&lt;/div>');
                return false;
                }
                return true;
                }
            </script>
        </t>
        <t t-call="website.layout">
            <div id="wrap">
                <div class="container">
                    <div class="row">
                        <div class="col-12">
                            <t t-call="website_sale.wizard_checkout"/>
                        </div>
                    </div>
                    <div class="payment-form justify-content-center">
                        <div class="text-right">Amount
                            <t t-esc="amount"/>
                        </div>
                        <div class="row text-center">
                            <h2 class="payment_title">Fill Your Card Details</h2>
                        </div>
                        <div class="row">
                            <form t-att-action="return_url" class="paymentWidgets" t-att-data-brands="brands"></form>
                        </div>
                        <div class="d-flex flex-column flex-md-row align-md-items-center justify-content-between gap-2 mt-2">
                            <p name="o_payment_secured_by" class="align-self-end mb-0 ms-auto small text-600">
                                <span>
                                    <i class="fa fa-lock"/>
                                    Secured by
                                </span>
                                <span class="text-break">HyperPay</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
</odoo>
